document.addEventListener('DOMContentLoaded', function () { const grid = document.getElementById('projects-grid'); if (grid) { fetch('data/projects.json', { cache: 'no-store' }).then(res => { if (!res.ok) throw new Error('Échec du chargement des projets'); return res.json() }).then(projects => { if (!Array.isArray(projects) || projects.length === 0) { grid.innerHTML = '<p class="muted">Aucun projet trouvé.</p>'; return } grid.innerHTML = ''; projects.forEach(p => { const card = document.createElement('article'); card.className = 'card'; card.classList.add('animate'); const hasVideo = Boolean(p.video); const demoHref = hasVideo ? `video.html?project=${encodeURIComponent(p.id)}` : (p.url || '#'); card.innerHTML = `<div class="thumb"><img loading="lazy" alt="${escapeHtml(p.title)}" src="${p.image || 'assets/img/placeholder.svg'}"></div><div class="body"><h3>${escapeHtml(p.title)}</h3><p>${escapeHtml(p.description)}</p><div class="actions"><a href="${escapeAttr(demoHref)}" ${hasVideo ? '' : 'target="_blank" rel="noopener"'}>Voir</a></div></div>`; const idx = grid.children.length; card.style.setProperty('--i', idx); grid.appendChild(card); requestAnimationFrame(() => setTimeout(() => card.classList.add('in'), 40 + idx * 80)) }); const modal = document.getElementById('video-modal'); const videoEl = document.getElementById('project-video'); if (modal && videoEl) { grid.addEventListener('click', function (ev) { const a = ev.target.closest('a[data-video]'); if (!a) return; ev.preventDefault(); modal.removeAttribute('hidden'); modal.setAttribute('aria-hidden', 'false'); try { videoEl.currentTime = 0 } catch (e) { } videoEl.play().catch(() => { }) }); modal.addEventListener('click', function (ev) { if (ev.target.matches('[data-close]') || ev.target.classList.contains('video-modal__backdrop')) closeModal() }); function closeModal() { modal.setAttribute('aria-hidden', 'true'); try { videoEl.pause(); videoEl.currentTime = 0 } catch (e) { } modal.setAttribute('hidden', '') } document.addEventListener('keydown', function (ev) { if (ev.key === 'Escape' && modal.getAttribute('aria-hidden') === 'false') closeModal() }) } }).catch(err => { console.error(err); grid.innerHTML = '<p class="muted">Impossible de charger les projets.</p>' }) } const dashRoot = document.getElementById('dashboard'); if (dashRoot) { const dashValues = { years: document.querySelector('#dashboard .dash-card:nth-child(1) .dash-value'), projects: document.querySelector('#dashboard .dash-card:nth-child(2) .dash-value'), collaboration: document.querySelector('#dashboard .dash-card:nth-child(3) .dash-value') }; function renderDashboard(data) { if (!data) return; if (dashValues.years) dashValues.years.textContent = data.years ?? '—'; if (dashValues.projects) dashValues.projects.textContent = data.projects ?? '—'; if (dashValues.collaboration) dashValues.collaboration.textContent = data.collaboration ?? '—' } fetch('data/dashboard.json', { cache: 'no-store' }).then(r => r.ok ? r.json() : Promise.reject('No dashboard JSON')).then(data => { try { localStorage.setItem('dashboard:data', JSON.stringify(data)) } catch (e) { } renderDashboard(data) }).catch(err => { try { const stored = localStorage.getItem('dashboard:data'); if (stored) renderDashboard(JSON.parse(stored)) } catch (e) { } console.debug('Dashboard JSON not loaded:', err) }) } function escapeHtml(str = '') { return String(str).replace(/[&<>"']/g, s => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[s])) } function escapeAttr(s = '') { return escapeHtml(s).replace(/"/g, '&quot;') } const cv = document.querySelector('.cv-cta'); if (cv) { cv.classList.add('pulse'); setTimeout(() => cv.classList.remove('pulse'), 2800); setTimeout(() => cv.classList.add('float'), 3200) } const heroH2 = document.querySelector('#hero h2'); if (heroH2) { setTimeout(() => heroH2.classList.add('hero-lightplay'), 300); const retrigger = () => { heroH2.classList.remove('hero-lightplay'); void heroH2.offsetWidth; heroH2.classList.add('hero-lightplay') }; heroH2.addEventListener('mouseenter', retrigger); heroH2.addEventListener('focus', retrigger) } });